<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agency Profile Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- Existing Cover Image and Profile Sections -->
    <div class="relative">
        <img id="cimage" src="" alt="Cover Image" class="w-full h-52 object-cover">
        <button id="changeCoverBtn" class="absolute top-4 right-4 bg-gray-900 text-white p-2 rounded-full hover:bg-gray-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10l1.5-1.5a3 3 0 014.243 0L12 12l2.257-2.257a3 3 0 014.243 0L20 10M3 20h18M5 20a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v11a2 2 0 01-2 2h-4" />
            </svg>
        </button>
        <input name="cimage" type="file" id="uploadCoverInput" class="hidden" accept="image/*">
    </div>

    <div class="flex mt-6 px-6">
        <div class="relative -mt-16">
            <img id="avatar" src="" alt="Profile Image" class="w-32 h-32 object-cover rounded-full border-4 border-white shadow-lg">
            <button id="changeAvatarBtn" class="absolute bottom-0 right-0 bg-gray-900 text-white p-2 rounded-full hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10l1.5-1.5a3 3 0 014.243 0L12 12l2.257-2.257a3 3 0 014.243 0L20 10M3 20h18M5 20a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v11a2 2 0 01-2 2h-4" />
                </svg>
            </button>
            <input name="avatar" type="file" id="uploadAvatarInput" class="hidden" accept="image/*">
        </div>
        <div class="ml-8 mt-8">
            <h1 id="agencyName" class="text-2xl font-semibold text-gray-800"></h1>
            <p id="address" class="text-gray-600"></p>
            <p id="email" class="text-gray-600"></p>
            <p id="phone" class="text-gray-600"></p>
            <a id="wlink" class="text-blue-500 hover:underline" target="_blank">Website</a>
        </div>
    </div>
        <!-- Existing Cover Image and Profile Sections -->
    
        <!-- Add this container for children cards -->
        <div id="childrenContainer" class="mt-8 px-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <!-- Child cards will be dynamically inserted here -->
        </div>
    
        <button onclick="window.location.href='childinput.html'" class="mt-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
            Add Children
        </button>

</body>
<script>
    async function fetchAgencyDetails() {
        try {
            const response = await fetch('/agencyDetails', {
                method: 'GET',
                credentials: 'include',
            });
            if (!response.ok) {
                throw new Error('Failed to fetch agency details');
            }

            const result = await response.json();
            const data = result.data.detail;

            // Update the HTML elements with agency data
            document.getElementById('agencyName').textContent = `AGENCY NAME: ${data[1]}`;
            document.getElementById('address').textContent = `ADDRESS: ${data[3]}`;
            document.getElementById('email').textContent = `EMAIL: ${data[4]}`;
            document.getElementById('phone').textContent = `CONTACT: ${data[5]}`;
            document.getElementById('cimage').src = data[9] || 'default_cover.jpg';
            document.getElementById('avatar').src = data[8] || 'default_avatar.jpg';
            document.getElementById('wlink').href = data[6];
        } catch (err) {
            console.error(err);
        }
    }


   // Trigger file input click for cover image
   document.getElementById('changeCoverBtn').addEventListener('click', () => {
    document.getElementById('uploadCoverInput').click();
});

const uploadCoverInput = document.getElementById('uploadCoverInput');

if (uploadCoverInput) {
    uploadCoverInput.addEventListener('change', async (e) => {
        const file = e.target.files ? e.target.files : null;

        if (!file) {
            console.log("No file selected");
            return;
        }

        const formData = new FormData();
        formData.append('cimage', file[0]);

        try {
            const response = await fetch('/uploadCoverImage', {
                method: 'POST',
                body: formData,
                credentials: 'include'
            });

            if (response.ok) {
                const result = await response.json();
                location.reload();
                console.log("Image upload successful:", result);
            } else {
                console.log("Something went wrong", response.statusText);
            }
        } catch (err) {
            console.log("Error uploading image:", err);
        }
    });
} else {
    console.error("File input element with ID 'uploadCoverInput' not found.");
}

// Trigger file input click for avatar
document.getElementById('changeAvatarBtn').addEventListener('click', () => {
    document.getElementById('uploadAvatarInput').click();
});

const uploadAvatarInput = document.getElementById('uploadAvatarInput');

if (uploadAvatarInput) {
    uploadAvatarInput.addEventListener('change', async (e) => {
        const file = e.target.files ? e.target.files : null;

        if (!file) {
            console.log("No file selected");
            return;
        }

        const formData = new FormData();
        formData.append('avatar', file[0]);

        try {
            const response = await fetch('/uploadavatar', {
                method: 'POST',
                body: formData,
                credentials: 'include'
            });

            if (response.ok) {
                const result = await response.json();
                location.reload();
                console.log("Avatar successfully uploaded", result);
            } else {
                console.log("Something went wrong:", response.statusText);
            }
        } catch (err) {
            console.log("Error uploading avatar:", err);
        }
    });
} else {
    console.error("File input element with ID 'uploadAvatarInput' not found.");
}
async function fetchChildren() {
    try {
        const response = await fetch('/getChildren', {
            method: 'GET',
            credentials: 'include',
        });
        if (!response.ok) {
            throw new Error('Failed to fetch children');
        }

        const children = await response.json();
        console.log(children)
        const childrenContainer = document.getElementById('childrenContainer');
        childrenContainer.innerHTML = ''; // Clear existing cards

        children.data.forEach((child) => {
            const childCard = `
                <div class="bg-white p-4 rounded-lg shadow-md flex flex-col items-center transform transition-transform duration-300 hover:scale-105">
                    <div class="w-48 h-48 bg-gray-200 rounded-lg overflow-hidden">
                        <img src="${child.photo || 'default_child_photo.jpg'}" alt="${child.name}" class="w-full h-full object-cover">
                    </div>
                    <h2 class="mt-4 text-lg font-semibold text-gray-800">${child.name}</h2>
                    <p class="text-gray-600">Status: ${child.status}</p>
                    <p class="text-gray-600">Age: ${child.age}</p>
                    <label class="mt-4 block">
                        <input type="file" class="hidden">
                        <span class="px-3 py-1 bg-blue-600 text-white rounded cursor-pointer">Upload Photo</span>
                    </label>
                </div>
            `;
            childrenContainer.innerHTML += childCard; // Append the new card
        });
    } catch (err) {
        console.error(err);
    }
}
window.onload = () => {
    fetchAgencyDetails();
    fetchChildren();
};
</script>
</html>
